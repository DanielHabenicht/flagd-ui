<h2 mat-dialog-title>Add Flag File</h2>

<mat-dialog-content>
  <mat-tab-group>
    <!-- Tab 1: Empty local file -->
    <mat-tab label="Empty File">
      <div class="tab-content">
        <p class="tab-description">Create an empty local flag file stored in your browser.</p>
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>File name</mat-label>
          <input matInput [(ngModel)]="projectName" placeholder="my-flags" />
        </mat-form-field>
        <div class="tab-actions">
          <button mat-flat-button color="primary" (click)="createEmptyProject()" [disabled]="!projectName.trim()">
            <mat-icon>computer</mat-icon> Create Local File
          </button>
        </div>
      </div>
    </mat-tab>

    <!-- Tab 2: Import from URL -->
    <mat-tab label="From URL">
      <div class="tab-content">
        <p class="tab-description">Import a <code>.flagd.json</code> file from a URL. The file will be stored locally.</p>
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>File URL</mat-label>
          <input matInput [(ngModel)]="fileUrl" placeholder="https://example.com/flags.flagd.json" />
        </mat-form-field>
        @if (urlLoading) {
          <mat-progress-bar mode="indeterminate"></mat-progress-bar>
        }
        @if (urlError) {
          <div class="error-message">{{ urlError }}</div>
        }
        <div class="tab-actions">
          <button mat-flat-button color="primary" (click)="importFromUrl()" [disabled]="!fileUrl.trim() || urlLoading">
            <mat-icon>download</mat-icon> Import File
          </button>
        </div>
      </div>
    </mat-tab>

    <!-- Tab 3: Connect backend -->
    <mat-tab label="Connect Backend">
      <div class="tab-content">
        <p class="tab-description">Connect to a flagd-ui backend instance to manage its flag files remotely.</p>
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Backend URL</mat-label>
          <input matInput [(ngModel)]="backendUrl" placeholder="https://flagd.example.com:3000" />
        </mat-form-field>
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Label (optional)</mat-label>
          <input matInput [(ngModel)]="backendLabel" placeholder="Production" />
        </mat-form-field>
        @if (backendLoading) {
          <mat-progress-bar mode="indeterminate"></mat-progress-bar>
        }
        @if (backendError) {
          <div class="error-message">{{ backendError }}</div>
        }
        @if (discoveredFiles.length) {
          <div class="discovered">
            <span class="discovered-label">Discovered {{ discoveredFiles.length }} flag file(s):</span>
            <ul>
              @for (f of discoveredFiles; track f) {
                <li>{{ f }}</li>
              }
            </ul>
          </div>
        }
        <div class="tab-actions">
          @if (!discoveredFiles.length) {
            <button mat-stroked-button (click)="discoverBackend()" [disabled]="!backendUrl.trim() || backendLoading">
              <mat-icon>search</mat-icon> Discover Files
            </button>
          } @else {
            <button mat-flat-button color="primary" (click)="addBackend()">
              <mat-icon>cloud</mat-icon> Add Backend
            </button>
          }
        </div>
      </div>
    </mat-tab>
  </mat-tab-group>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="cancel()">Cancel</button>
</mat-dialog-actions>
