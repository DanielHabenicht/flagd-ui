services:
  # flagd-ui:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #   image: flagd-ui:local
  #   user: "${UID:-1000}:${GID:-1000}"
  #   ports:
  #     - '3000:3000'
  #   volumes:
  #     - ./flags:/app/flags

  flagd:
    image: ghcr.io/open-feature/flagd:latest
    volumes:
      - ./flags:/flags
    command: [ 'start', '--uri', 'file:./flags/demo.flagd.json' ]
    ports:
      - '8013:8013'
      - '8016:8016'
      - '8014:8014'


  azurite:
    image: local-azurite:latest
    build:
      context: services/azurite
    ports:
      - 10000:10000
      - 10001:10001
      - 10002:10002
    volumes:
      - ./services/azurite/azurite-store:/data
      - ./services/azurite/azurite-logs:/logs

  azurite-init:
    image: mcr.microsoft.com/azure-cli:2.81.0
    depends_on:
      - azurite
    volumes:
      - ./services/azurite/init.sh:/workdir/init.sh:ro
      - ./flags/demo.flagd.json:/workdir/demo.flagd.json
    working_dir: /workdir
    command: ["sh", "/workdir/init.sh"]

  # auth:
  #   image: local-keycloak:latest
  #   build: ./services/authentication
  #   environment:
  #     - KEYCLOAK_ADMIN=admin
  #     - KEYCLOAK_ADMIN_PASSWORD=admin
  #   ports:
  #     - 8080:8080
  #   command:
  #     - start-dev
  #     - --import-realm
